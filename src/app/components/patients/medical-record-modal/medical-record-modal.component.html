<form [formGroup]="medicalRecordForm" (ngSubmit)="onSubmit()" class="space-y-4">
  <!-- Fecha -->
  <div>
    <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Fecha *</label>
    <input
      type="date"
      id="date"
      formControlName="date"
      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200"
      [class.border-red-500]="getFieldError('date')"
    />
    <p class="text-red-500 text-xs mt-1" *ngIf="getFieldError('date')">{{ getFieldError('date') }}</p>
  </div>

  <!-- Descripción -->
  <div>
    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Descripción *</label>
    <textarea
      id="description"
      formControlName="description"
      rows="3"
      placeholder="Describe el registro médico..."
      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200 resize-none"
      [class.border-red-500]="getFieldError('description')"
    ></textarea>
    <p class="text-red-500 text-xs mt-1" *ngIf="getFieldError('description')">{{ getFieldError('description') }}</p>
  </div>

  <!-- Imagen -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Imagen</label>
    
    <!-- Estado de compresión -->
    <div *ngIf="isCompressingImage" class="mb-2 p-3 bg-blue-50 border border-blue-200 rounded-lg">
      <div class="flex items-center">
        <i class="fas fa-spinner fa-spin text-blue-500 mr-2"></i>
        <span class="text-sm text-blue-700">Comprimiendo imagen...</span>
      </div>
    </div>
    
    <!-- Botones de selección -->
    <div class="flex gap-2 mb-2">
      <label class="flex-1 inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors duration-200">
        <i class="fas fa-camera mr-2"></i>
        Cámara
        <input type="file" accept="image/*" capture="camera" (change)="onImageSelected($event)" class="hidden">
      </label>
      <label class="flex-1 inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors duration-200">
        <i class="fas fa-images mr-2"></i>
        Galería
        <input type="file" accept="image/*" (change)="onImageSelected($event)" class="hidden">
      </label>
    </div>

    <!-- Preview de imagen -->
    <div *ngIf="imagePreview" class="mt-2">
      <div class="relative inline-block">
        <img [src]="imagePreview" alt="Preview" class="w-32 h-32 object-cover rounded-lg border border-gray-300">
        <button
          type="button"
          (click)="removeImage()"
          class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-colors duration-200"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- Estadísticas de compresión -->
      <div *ngIf="compressionStats" class="mt-2 p-2 bg-green-50 border border-green-200 rounded text-xs text-green-700">
        <div class="flex items-center justify-between">
          <span>Imagen comprimida:</span>
          <span class="font-semibold">{{ compressionStats.compressionRatio }}% reducción</span>
        </div>
        <div class="text-xs text-green-600 mt-1">
          {{ formatFileSize(compressionStats.originalSize) }} → {{ formatFileSize(compressionStats.compressedSize) }}
        </div>
      </div>
    </div>
  </div>

  <!-- Botones -->
  <div class="flex gap-3 pt-4">
    <button
      type="button"
      (click)="onCancel()"
      class="flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200"
    >
      Cancelar
    </button>
    <button
      type="submit"
      [disabled]="isLoading"
      class="flex-1 px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
    >
      <i class="fas fa-save mr-2" *ngIf="!isLoading"></i>
      <i class="fas fa-spinner fa-spin mr-2" *ngIf="isLoading"></i>
      {{ isLoading ? 'Guardando...' : 'Guardar' }}
    </button>
  </div>
</form>